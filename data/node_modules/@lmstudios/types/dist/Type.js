"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class Type {
    constructor() {
        this.Properties = [];
        this.Name = "";
        this.Namespace = "";
        this.FullName = "";
    }
    get UID() {
        return this.FullName;
    }
    GetProperty(name) {
        return this.Properties.find(x => { return x.Name === name; });
    }
    IsSubTypeOf(value) {
        let type;
        if (typeof (value) === "string") {
            type = Type.GetType(value);
            if (!(type instanceof Type))
                return false;
        }
        if (this.Constructor !== undefined) {
            var prototype = this.Constructor;
            while (prototype) {
                console.log(prototype);
                var subType = Type.GetType(prototype);
                prototype = prototype.prototype;
            }
        }
        return false;
    }
    static Create(value) {
        let uid = "";
        switch (typeof (value)) {
            case "string":
                uid = value;
                break;
            case "function":
                var prototype = value.prototype;
                if (prototype !== undefined)
                    uid = prototype.typeUID;
                break;
            default:
                throw new Error(`@lmstudios/types:Type.Create():Invalid parameter type`);
        }
        if (uid === undefined)
            throw new Error(`@lmstudios/types:Type.Create():Invalid parameter value`);
        var result = Type.Parse(uid);
        var types = Type.GetTypes();
        var exists = types.find(x => { return x.UID === result.UID; });
        if (exists === undefined)
            types.push(result);
        else
            result = exists;
        if (typeof (value) === "function") {
            value.prototype.type = result;
            if (result.Constructor === undefined)
                result.Constructor = value;
        }
        return result;
    }
    static Parse(uid) {
        var match = uid.match(/^([^<]+)([\w|\W]*)/);
        if (!match)
            throw new Error(`@lmstudios/types:Type.Parse():Invalid UID(${uid})`);
        var fullName = match[1].trim();
        var genericTypes = [];
        match = match[2].trim().match(/^\s*<(.+)>\s*$/);
        if (match) {
            var genericUIDs = [];
            var genericUID = "";
            var openTags = 0;
            for (var i = 0; i < match[1].length; i++) {
                switch (match[1][i]) {
                    case '<':
                        openTags++;
                        genericUID += match[1][i];
                        break;
                    case '>':
                        openTags--;
                        genericUID += match[1][i];
                    case ',':
                        if (openTags === 0) {
                            genericUIDs.push(genericUID);
                            genericUID = "";
                        }
                        else {
                            genericUID += match[1][i];
                        }
                        break;
                    default:
                        genericUID += match[1][i];
                        break;
                }
            }
            genericUIDs.push(genericUID);
            for (var i = 0; i < genericUIDs.length; i++) {
                genericTypes.push(Type.Create(genericUIDs[i]));
            }
        }
        var names = fullName.split('.');
        var name = names[names.length - 1];
        var namespace = "";
        for (var i = 0; i < names.length - 1; i++) {
            namespace += `${names[i]}.`;
        }
        ;
        namespace = namespace.replace(/\.$/, "");
        var result = new Type();
        result.Name = name;
        result.Namespace = namespace;
        result.FullName = name;
        if (namespace.length > 0)
            result.FullName = `${namespace}.${name}`;
        result.GenericTypes = genericTypes;
        return result;
        var result = new Type();
    }
    static GetType(value) {
        console.log(value);
        switch (typeof (value)) {
            case "string":
                return Type.GetTypes().find(x => { return x.UID === value; });
            case "function":
                console.log(value);
                var result = Type.GetTypes().find(x => { return x.__proto__ === value; });
                console.log(result);
                return result;
            default:
                console.log(typeof (value));
                break;
        }
    }
    static GetTypes() {
        if (window.lmstudios == undefined)
            window.lmstudios = {};
        if (window.lmstudios.Types === undefined)
            window.lmstudios.Types = [];
        return window.lmstudios.Types;
    }
}
exports.Type = Type;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHlwZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9UeXBlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBRUEsTUFBYSxJQUFJO0lBQ2I7UUFXTyxlQUFVLEdBQWMsRUFBRSxDQUFDO1FBVjlCLElBQUksQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ2YsSUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7UUFDcEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7SUFDdkIsQ0FBQztJQUNELElBQVcsR0FBRztRQUNWLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztJQUN6QixDQUFDO0lBS00sV0FBVyxDQUFDLElBQVc7UUFDMUIsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLE9BQU8sQ0FBQyxDQUFDLElBQUksS0FBSyxJQUFJLENBQUEsQ0FBQSxDQUFDLENBQUMsQ0FBQztJQUNoRSxDQUFDO0lBWU0sV0FBVyxDQUFDLEtBQWlCO1FBQ2hDLElBQUksSUFBbUIsQ0FBQztRQUN4QixJQUFJLE9BQU0sQ0FBQyxLQUFLLENBQUMsS0FBRyxRQUFRLEVBQUM7WUFDekIsSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDM0IsSUFBSSxDQUFFLENBQUMsSUFBSSxZQUFZLElBQUksQ0FBQztnQkFDeEIsT0FBTyxLQUFLLENBQUE7U0FDbkI7UUFDRCxJQUFJLElBQUksQ0FBQyxXQUFXLEtBQUssU0FBUyxFQUFDO1lBQy9CLElBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUE7WUFDaEMsT0FBTyxTQUFTLEVBQUM7Z0JBQ2IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFDdkIsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFDdEMsU0FBUyxHQUFHLFNBQVMsQ0FBQyxTQUFTLENBQUM7YUFDbkM7U0FDSjtRQUNELE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7SUFHTSxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQTBDO1FBQzNELElBQUksR0FBRyxHQUFVLEVBQUUsQ0FBQztRQUNwQixRQUFRLE9BQU0sQ0FBQyxLQUFLLENBQUMsRUFBQztZQUNsQixLQUFLLFFBQVE7Z0JBQ1QsR0FBRyxHQUFXLEtBQUssQ0FBQztnQkFDcEIsTUFBTTtZQUNWLEtBQUssVUFBVTtnQkFDWCxJQUFJLFNBQVMsR0FBbUMsS0FBTSxDQUFDLFNBQVMsQ0FBQztnQkFDakUsSUFBSSxTQUFTLEtBQUssU0FBUztvQkFDdkIsR0FBRyxHQUFHLFNBQVMsQ0FBQyxPQUFPLENBQUM7Z0JBQzVCLE1BQU07WUFDVjtnQkFDSSxNQUFNLElBQUksS0FBSyxDQUFDLHVEQUF1RCxDQUFDLENBQUM7U0FDaEY7UUFDRCxJQUFJLEdBQUcsS0FBSyxTQUFTO1lBQ2pCLE1BQU0sSUFBSSxLQUFLLENBQUMsd0RBQXdELENBQUMsQ0FBQztRQUM5RSxJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRTdCLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUM1QixJQUFJLE1BQU0sR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsT0FBTyxDQUFDLENBQUMsR0FBRyxLQUFLLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMvRCxJQUFJLE1BQU0sS0FBSyxTQUFTO1lBQ3BCLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7O1lBRW5CLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDcEIsSUFBSSxPQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssVUFBVSxFQUFDO1lBQ0csS0FBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDO1lBQy9ELElBQUksTUFBTSxDQUFDLFdBQVcsS0FBSyxTQUFTO2dCQUNoQyxNQUFNLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQztTQUNsQztRQUNELE9BQU8sTUFBTSxDQUFDO0lBRWxCLENBQUM7SUFDTSxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQVU7UUFDMUIsSUFBSSxLQUFLLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1FBQzVDLElBQUksQ0FBRSxLQUFLO1lBQ1AsTUFBTSxJQUFJLEtBQUssQ0FBQyw2Q0FBNkMsR0FBRyxHQUFHLENBQUMsQ0FBQztRQUN6RSxJQUFJLFFBQVEsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFFL0IsSUFBSSxZQUFZLEdBQUcsRUFBRSxDQUFDO1FBQ3RCLEtBQUssR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDaEQsSUFBSSxLQUFLLEVBQUM7WUFDTixJQUFJLFdBQVcsR0FBRyxFQUFFLENBQUM7WUFDckIsSUFBSSxVQUFVLEdBQUcsRUFBRSxDQUFDO1lBQ3BCLElBQUksUUFBUSxHQUFHLENBQUMsQ0FBQztZQUNqQixLQUFLLElBQUksQ0FBQyxHQUFDLENBQUMsRUFBRSxDQUFDLEdBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBQztnQkFDakMsUUFBUSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUM7b0JBQ2hCLEtBQUssR0FBRzt3QkFDSixRQUFRLEVBQUcsQ0FBQzt3QkFDWixVQUFVLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUMxQixNQUFNO29CQUNWLEtBQUssR0FBRzt3QkFDSixRQUFRLEVBQUcsQ0FBQzt3QkFDWixVQUFVLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUM5QixLQUFLLEdBQUc7d0JBQ0osSUFBSSxRQUFRLEtBQUssQ0FBQyxFQUFDOzRCQUNmLFdBQVcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7NEJBQzdCLFVBQVUsR0FBRyxFQUFFLENBQUM7eUJBQ25COzZCQUNHOzRCQUNBLFVBQVUsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7eUJBQzdCO3dCQUNELE1BQU07b0JBQ1Y7d0JBQ0ksVUFBVSxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDMUIsTUFBTTtpQkFDYjthQUNKO1lBQ0QsV0FBVyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUM3QixLQUFLLElBQUksQ0FBQyxHQUFDLENBQUMsRUFBRSxDQUFDLEdBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBQztnQkFDcEMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7YUFDakQ7U0FDSjtRQUVELElBQUksS0FBSyxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDaEMsSUFBSSxJQUFJLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUMsQ0FBQyxDQUFDLENBQUM7UUFDakMsSUFBSSxTQUFTLEdBQUcsRUFBRSxDQUFDO1FBQ25CLEtBQUksSUFBSSxDQUFDLEdBQUMsQ0FBQyxFQUFFLENBQUMsR0FBQyxLQUFLLENBQUMsTUFBTSxHQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBQztZQUMvQixTQUFTLElBQUksR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQTtTQUM5QjtRQUFBLENBQUM7UUFDRixTQUFTLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFekMsSUFBSSxNQUFNLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUN4QixNQUFNLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNuQixNQUFNLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQztRQUM3QixNQUFNLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUN2QixJQUFJLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQztZQUNwQixNQUFNLENBQUMsUUFBUSxHQUFHLEdBQUcsU0FBUyxJQUFJLElBQUksRUFBRSxDQUFBO1FBQzVDLE1BQU0sQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDO1FBQ25DLE9BQU8sTUFBTSxDQUFDO1FBR2QsSUFBSSxNQUFNLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztJQUM1QixDQUFDO0lBQ00sTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUEwQztRQUM1RCxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ25CLFFBQVEsT0FBTSxDQUFDLEtBQUssQ0FBQyxFQUFDO1lBQ2xCLEtBQUssUUFBUTtnQkFDVCxPQUFPLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxPQUFPLENBQUMsQ0FBQyxHQUFHLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEUsS0FBSyxVQUFVO2dCQUNYLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ25CLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxPQUFhLENBQUUsQ0FBQyxTQUFTLEtBQUssS0FBSyxDQUFBLENBQUMsQ0FBQyxDQUFDLENBQUE7Z0JBQy9FLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ3BCLE9BQU8sTUFBTSxDQUFDO1lBQ2xCO2dCQUNJLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQzNCLE1BQU07U0FDYjtJQUVMLENBQUM7SUFFTSxNQUFNLENBQUMsUUFBUTtRQUNsQixJQUFVLE1BQU8sQ0FBQyxTQUFTLElBQUksU0FBUztZQUM5QixNQUFPLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQTtRQUNoQyxJQUFVLE1BQU8sQ0FBQyxTQUFTLENBQUMsS0FBSyxLQUFLLFNBQVM7WUFDckMsTUFBTyxDQUFDLFNBQVMsQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO1FBQ3ZDLE9BQWEsTUFBTyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUM7SUFDekMsQ0FBQztDQUNIO0FBbktGLG9CQW1LRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByb3BlcnR5IH0gZnJvbSBcIi4vUHJvcGVydHlcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBUeXBlIHtcclxuICAgIGNvbnN0cnVjdG9yKCl7XHJcbiAgICAgICAgdGhpcy5OYW1lID0gXCJcIjtcclxuICAgICAgICB0aGlzLk5hbWVzcGFjZSA9IFwiXCI7XHJcbiAgICAgICAgdGhpcy5GdWxsTmFtZSA9IFwiXCI7ICBcclxuICAgIH0gXHJcbiAgICBwdWJsaWMgZ2V0IFVJRCgpOnN0cmluZ3tcclxuICAgICAgICByZXR1cm4gdGhpcy5GdWxsTmFtZTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBOYW1lOnN0cmluZztcclxuICAgIHB1YmxpYyBOYW1lc3BhY2U6c3RyaW5nO1xyXG4gICAgcHVibGljIEZ1bGxOYW1lOnN0cmluZztcclxuICAgIHB1YmxpYyBQcm9wZXJ0aWVzOlByb3BlcnR5W10gPSBbXTtcclxuICAgIHB1YmxpYyBHZXRQcm9wZXJ0eShuYW1lOnN0cmluZyk6UHJvcGVydHl8dW5kZWZpbmVke1xyXG4gICAgICAgIHJldHVybiB0aGlzLlByb3BlcnRpZXMuZmluZCh4ID0+IHsgcmV0dXJuIHguTmFtZSA9PT0gbmFtZX0pO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBCYXNlVHlwZT86VHlwZTtcclxuICAgIHB1YmxpYyBHZW5lcmljVHlwZXM/OlR5cGVbXTtcclxuXHJcblxyXG5cclxuXHJcblxyXG4gICAgcHVibGljIENvbnN0cnVjdG9yPzoobmV3ICguLi5hcmdzOiBhbnlbXSkgPT4gYW55KTtcclxuXHJcblxyXG4gICAgcHVibGljIElzU3ViVHlwZU9mKHZhbHVlOnN0cmluZ3xUeXBlKTpib29sZWFue1xyXG4gICAgICAgIGxldCB0eXBlOlR5cGV8dW5kZWZpbmVkO1xyXG4gICAgICAgIGlmICh0eXBlb2YodmFsdWUpPT09XCJzdHJpbmdcIil7XHJcbiAgICAgICAgICAgIHR5cGUgPSBUeXBlLkdldFR5cGUodmFsdWUpO1xyXG4gICAgICAgICAgICBpZiAoISAodHlwZSBpbnN0YW5jZW9mIFR5cGUpKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLkNvbnN0cnVjdG9yICE9PSB1bmRlZmluZWQpe1xyXG4gICAgICAgICAgICB2YXIgcHJvdG90eXBlID0gdGhpcy5Db25zdHJ1Y3RvclxyXG4gICAgICAgICAgICB3aGlsZSAocHJvdG90eXBlKXtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHByb3RvdHlwZSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3ViVHlwZSA9IFR5cGUuR2V0VHlwZShwcm90b3R5cGUpOyAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBwcm90b3R5cGUgPSBwcm90b3R5cGUucHJvdG90eXBlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBDcmVhdGUodmFsdWU6c3RyaW5nfChuZXcgKC4uLmFyZ3M6IGFueVtdKSA9PiBhbnkpKTpUeXBle1xyXG4gICAgICAgIGxldCB1aWQ6c3RyaW5nID0gXCJcIjtcclxuICAgICAgICBzd2l0Y2ggKHR5cGVvZih2YWx1ZSkpe1xyXG4gICAgICAgICAgICBjYXNlIFwic3RyaW5nXCI6XHJcbiAgICAgICAgICAgICAgICB1aWQgPSA8c3RyaW5nPnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCJmdW5jdGlvblwiOlxyXG4gICAgICAgICAgICAgICAgdmFyIHByb3RvdHlwZSA9ICg8KG5ldyAoLi4uYXJnczogYW55W10pID0+IGFueSk+dmFsdWUpLnByb3RvdHlwZTtcclxuICAgICAgICAgICAgICAgIGlmIChwcm90b3R5cGUgIT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICB1aWQgPSBwcm90b3R5cGUudHlwZVVJRDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBAbG1zdHVkaW9zL3R5cGVzOlR5cGUuQ3JlYXRlKCk6SW52YWxpZCBwYXJhbWV0ZXIgdHlwZWApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodWlkID09PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQGxtc3R1ZGlvcy90eXBlczpUeXBlLkNyZWF0ZSgpOkludmFsaWQgcGFyYW1ldGVyIHZhbHVlYCk7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IFR5cGUuUGFyc2UodWlkKTtcclxuXHJcbiAgICAgICAgdmFyIHR5cGVzID0gVHlwZS5HZXRUeXBlcygpO1xyXG4gICAgICAgIHZhciBleGlzdHMgPSB0eXBlcy5maW5kKHggPT4geyByZXR1cm4geC5VSUQgPT09IHJlc3VsdC5VSUQ7IH0pO1xyXG4gICAgICAgIGlmIChleGlzdHMgPT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgdHlwZXMucHVzaChyZXN1bHQpO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgcmVzdWx0ID0gZXhpc3RzOyAgICAgICAgICAgXHJcbiAgICAgICAgaWYgKHR5cGVvZih2YWx1ZSkgPT09IFwiZnVuY3Rpb25cIil7XHJcbiAgICAgICAgICAgICg8KG5ldyAoLi4uYXJnczogYW55W10pID0+IGFueSk+dmFsdWUpLnByb3RvdHlwZS50eXBlID0gcmVzdWx0O1xyXG4gICAgICAgICAgICBpZiAocmVzdWx0LkNvbnN0cnVjdG9yID09PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICByZXN1bHQuQ29uc3RydWN0b3IgPSB2YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDsgICAgICAgIFxyXG5cclxuICAgIH1cclxuICAgIHB1YmxpYyBzdGF0aWMgUGFyc2UodWlkOnN0cmluZyk6VHlwZXtcclxuICAgICAgICB2YXIgbWF0Y2ggPSB1aWQubWF0Y2goL14oW148XSspKFtcXHd8XFxXXSopLyk7XHJcbiAgICAgICAgaWYgKCEgbWF0Y2gpXHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQGxtc3R1ZGlvcy90eXBlczpUeXBlLlBhcnNlKCk6SW52YWxpZCBVSUQoJHt1aWR9KWApO1xyXG4gICAgICAgIHZhciBmdWxsTmFtZSA9IG1hdGNoWzFdLnRyaW0oKTtcclxuIFxyXG4gICAgICAgIHZhciBnZW5lcmljVHlwZXMgPSBbXTtcclxuICAgICAgICBtYXRjaCA9IG1hdGNoWzJdLnRyaW0oKS5tYXRjaCgvXlxccyo8KC4rKT5cXHMqJC8pO1xyXG4gICAgICAgIGlmIChtYXRjaCl7XHJcbiAgICAgICAgICAgIHZhciBnZW5lcmljVUlEcyA9IFtdO1xyXG4gICAgICAgICAgICB2YXIgZ2VuZXJpY1VJRCA9IFwiXCI7XHJcbiAgICAgICAgICAgIHZhciBvcGVuVGFncyA9IDA7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGk9MDsgaTxtYXRjaFsxXS5sZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKG1hdGNoWzFdW2ldKXtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICc8JzogXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5UYWdzICsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmljVUlEICs9IG1hdGNoWzFdW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICc+JzogXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5UYWdzIC0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmljVUlEICs9IG1hdGNoWzFdW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJywnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob3BlblRhZ3MgPT09IDApe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2VuZXJpY1VJRHMucHVzaChnZW5lcmljVUlEKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdlbmVyaWNVSUQgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW5lcmljVUlEICs9IG1hdGNoWzFdW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdlbmVyaWNVSUQgKz0gbWF0Y2hbMV1baV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9ICAgIFxyXG4gICAgICAgICAgICBnZW5lcmljVUlEcy5wdXNoKGdlbmVyaWNVSUQpOyAgICAgXHJcbiAgICAgICAgICAgIGZvciAodmFyIGk9MDsgaTxnZW5lcmljVUlEcy5sZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICBnZW5lcmljVHlwZXMucHVzaChUeXBlLkNyZWF0ZShnZW5lcmljVUlEc1tpXSkpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBuYW1lcyA9IGZ1bGxOYW1lLnNwbGl0KCcuJyk7XHJcbiAgICAgICAgdmFyIG5hbWUgPSBuYW1lc1tuYW1lcy5sZW5ndGgtMV07XHJcbiAgICAgICAgdmFyIG5hbWVzcGFjZSA9IFwiXCI7XHJcbiAgICAgICAgZm9yKHZhciBpPTA7IGk8bmFtZXMubGVuZ3RoLTE7IGkrKyl7XHJcbiAgICAgICAgICAgIG5hbWVzcGFjZSArPSBgJHtuYW1lc1tpXX0uYFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgbmFtZXNwYWNlID0gbmFtZXNwYWNlLnJlcGxhY2UoL1xcLiQvLCBcIlwiKTtcclxuXHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBUeXBlKCk7XHJcbiAgICAgICAgcmVzdWx0Lk5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHJlc3VsdC5OYW1lc3BhY2UgPSBuYW1lc3BhY2U7XHJcbiAgICAgICAgcmVzdWx0LkZ1bGxOYW1lID0gbmFtZTtcclxuICAgICAgICBpZiAobmFtZXNwYWNlLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgIHJlc3VsdC5GdWxsTmFtZSA9IGAke25hbWVzcGFjZX0uJHtuYW1lfWBcclxuICAgICAgICByZXN1bHQuR2VuZXJpY1R5cGVzID0gZ2VuZXJpY1R5cGVzO1xyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcblxyXG5cclxuICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFR5cGUoKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBzdGF0aWMgR2V0VHlwZSh2YWx1ZTpzdHJpbmd8KG5ldyAoLi4uYXJnczogYW55W10pID0+IGFueSkpOlR5cGV8dW5kZWZpbmVke1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHZhbHVlKTtcclxuICAgICAgICBzd2l0Y2ggKHR5cGVvZih2YWx1ZSkpe1xyXG4gICAgICAgICAgICBjYXNlIFwic3RyaW5nXCI6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gVHlwZS5HZXRUeXBlcygpLmZpbmQoeCA9PiB7IHJldHVybiB4LlVJRCA9PT0gdmFsdWU7IH0pO1xyXG4gICAgICAgICAgICBjYXNlIFwiZnVuY3Rpb25cIjpcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBUeXBlLkdldFR5cGVzKCkuZmluZCh4ID0+IHsgcmV0dXJuICg8YW55PngpLl9fcHJvdG9fXyA9PT0gdmFsdWUgfSlcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2codHlwZW9mKHZhbHVlKSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBHZXRUeXBlcygpOlR5cGVbXXtcclxuICAgICAgICBpZiAoKDxhbnk+d2luZG93KS5sbXN0dWRpb3MgPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAoPGFueT53aW5kb3cpLmxtc3R1ZGlvcyA9IHt9ICAgICBcclxuICAgICAgICBpZiAoKDxhbnk+d2luZG93KS5sbXN0dWRpb3MuVHlwZXMgPT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgKDxhbnk+d2luZG93KS5sbXN0dWRpb3MuVHlwZXMgPSBbXTtcclxuICAgICAgICByZXR1cm4gKDxhbnk+d2luZG93KS5sbXN0dWRpb3MuVHlwZXM7XHJcbiAgICB9XHJcbiB9XHJcbiJdfQ==